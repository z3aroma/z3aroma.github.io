<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Modifica Citofoni Z3A</title>
    <link rel="stylesheet" href="css/admin.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Amministrazione Citofoni Z3A</h1>
            <div class="session-info" id="sessionInfo"></div>
        </div>
        
        <!-- Login Form -->
        <div class="login-container" id="loginContainer">
            <div class="login-form">
                <h2>Accesso Amministratore</h2>
                <input type="password" id="passwordInput" placeholder="Inserisci password" autocomplete="current-password">
                <button onclick="login()">Accedi</button>
                <div class="error-message" id="errorMessage">Password errata!</div>
            </div>
        </div>
        
        <!-- Admin Panel -->
        <div class="admin-panel" id="adminPanel">
            <div class="status-message status-success" id="successMessage"></div>
            <div class="status-message status-error" id="errorMessagePanel"></div>
            
            <div class="last-commit-info" id="lastCommitInfo" style="display:none;">
                <strong>Ultimo commit:</strong> <span id="lastCommitText"></span>
            </div>
            
            <div class="controls">
                <button class="btn btn-add" onclick="addRow()">‚ûï Aggiungi Citofono</button>
                <button class="btn btn-save" onclick="showSaveModal()">üíæ Salva Modifiche</button>
                <span class="unsaved-indicator" id="unsavedIndicator">‚ö†Ô∏è Modifiche non salvate</span>
                <button class="btn btn-undo" id="undoBtn" onclick="undo()" disabled>‚Ü∂ Annulla</button>
                <button class="btn btn-redo" id="redoBtn" onclick="redo()" disabled>‚Ü∑ Ripeti</button>
                
                <div class="search-container">
                    <input type="text" class="search-input" id="searchInput" placeholder="Cerca..." onkeyup="filterTable()">
                    <button class="btn btn-logout" onclick="showLogoutModal()">Esci</button>
                </div>
            </div>
            
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Caricamento in corso...</p>
            </div>
            
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th id="th-cognome" class="sortable" onclick="sortData('cognome')">Cognome</th>
                            <th id="th-citofono" class="sortable" onclick="sortData('citofono')">Citofono</th>
                            <th>Azioni</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
        </div>
    </div>
    
    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Conferma Eliminazione</h2>
            </div>
            <div class="modal-body">
                <p>Vuoi eliminare questa riga?</p>
                <p><strong id="deleteRowInfo"></strong></p>
                <p>La riga sar√† marcata per l'eliminazione e verr√† rimossa definitivamente quando salverai le modifiche.</p>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-cancel" onclick="closeDeleteModal()">Annulla</button>
                <button class="modal-btn modal-btn-confirm" id="confirmDeleteBtn" onclick="confirmDelete()">Elimina</button>
            </div>
        </div>
    </div>
    
    <!-- Save Changes Modal -->
    <div id="saveModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Conferma Salvataggio</h2>
            </div>
            <div class="modal-body">
                <p>Riepilogo delle modifiche:</p>
                <div class="diff-container" id="diffContainer"></div>
                <p>Messaggio di commit:</p>
                <textarea class="commit-message-input" id="commitMessageInput"></textarea>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-cancel" onclick="closeSaveModal()">Annulla</button>
                <button class="modal-btn modal-btn-save" onclick="confirmSave()">Salva e Committa</button>
            </div>
        </div>
    </div>
    
    <!-- Logout Confirmation Modal -->
    <div id="logoutModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Conferma Uscita</h2>
            </div>
            <div class="modal-body">
                <p id="logoutWarning"></p>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-cancel" onclick="closeLogoutModal()">Annulla</button>
                <button class="modal-btn modal-btn-confirm" onclick="confirmLogout()">Esci</button>
            </div>
        </div>
    </div>
    
    <script src="js/admin.js"></script>
</body>
</html>